import maya.cmds as cmds
import os
import json
from PySide2 import QtWidgets, QtCore, QtGui


# create first the joints - shoulder, knee, wrist, wristEnd (no need for naming)
# selection to a variable
"""
L_Leg_Setup=l_leg_setup()
L_Leg_Setup.L_bind_leg()

L_Leg_Setup=l_leg_setup()
L_Leg_Setup.L_ik_leg()

L_Leg_Setup=l_leg_setup()
L_Leg_Setup.L_fk_leg()

L_Leg_Setup=l_leg_setup()
L_Leg_Setup.L_connectIk_leg()

L_Leg_Setup=l_leg_setup()
L_Leg_Setup.L_connectFk_leg()
"""
class utillity():

    def create_space_groups(self, name=None):

        """
        creates space groups if not already in the scene
        :param name: group name
        :type name: str
        """

        if cmds.objExists(name):
            return
        else:
            cmds.group(empty=True, name=name)
            
    def gimbalX_attribute(self, object):                      
        cmds.addAttr(object, ln="gimbalX", at="double", dv=0)
        cmds.setAttr(object+'.gimbalX', e=True, k=True)
    
    def gimbalY_attribute(self, object):                      
        cmds.addAttr(object, ln="gimbalY", at="double", dv=0)
        cmds.setAttr(object+'.gimbalY', e=True, k=True)
       
    def gimbalZ_attribute(self, object):                      
        cmds.addAttr(object, ln="gimbalZ", at="double", dv=0)
        cmds.setAttr(object+'.gimbalZ', e=True, k=True)
    
    """
    creates space attr on your object and creates condotions nodes that you give a suffix name 
    To auto create the space setup you need to type in
    self.util.space_foot_follow_world_cnd(object=your object e.g a controller, name="Your suffix name")
    """        
    def space_foot_follow(self, object):
        cmds.addAttr(object, ln='footFollow', at='enum', en='hip:cog:world')
        cmds.setAttr(object+'.footFollow', e=True, k=True)    
    def space_foot_follow_world_cnd(self, object, name):
        cmds.shadingNode('condition', n=object+name, au=True)
    def space_foot_follow_hip_cnd(self, object, name):
        cmds.shadingNode('condition', n=object+name, au=True)
    def space_foot_follow_cog_cnd(self, object, name):
        cmds.shadingNode('condition', n=object+name, au=True)
        
    def space_knee_follow(self, object):
        cmds.addAttr(object, ln='kneeFollow', at='enum', en='foot:cog:world')
        cmds.setAttr(object+'.kneeFollow', e=True, k=True)

class l_leg_setup():

    def __init__(self):
        self.util = utillity()

    def L_bind_leg(self):
        # select 5 joints, femur, knee, ankle, ball, toeEnd in that order
        l_leg_sel = cmds.ls(selection=True)
        # make sure the selection is 5 by using the len() command
        if len(l_leg_sel) == 5:
            # rename the selected joints
            femur = cmds.rename(l_leg_sel[0], 'L_femur_jnt')
            knee = cmds.rename(l_leg_sel[1], 'L_knee_jnt')
            ankle = cmds.rename(l_leg_sel[2], 'L_ankle_jnt')
            ball = cmds.rename(l_leg_sel[3], 'L_ball_jnt')
            toe = cmds.rename(l_leg_sel[4], 'L_toe_jnt')
            # joint orient the joints
            cmds.select(femur)
            cmds.joint(e=True, oj='xyz', sao='zdown', ch=True, zso=True)
        else:
            print "select 5 joints - femur, knee, ankle, ball, toeEnd"
            return
            
        # place them in the group hierarchy if there is one
        
        if cmds.objExists("C_pelvis_jnt"): 
            pelvisJnt = "C_pelvis_jnt"
            rootJnt = "C_root"
            cmds.parent(femur, pelvisJnt)
            cmds.parent(rootJnt, 'skeleton_Grp')
            
        elif cmds.objExists("main_Grp"):
            cmds.parent(femur, 'skeleton_Grp')
            print "No C_pelvis_jnt"

        else:
            print "No C_pelvis_jnt an no base hierarchy" 

            
    def R_leg_mirror(self):
    
        #easy mirror tool
        #should make it more correct, so you would not mirror it but set the orientation correct in case you dont have the
        r_leg_sel = cmds.ls(selection=True)
        cmds.mirrorJoint('L_femur_jnt', mirrorYZ=True, mirrorBehavior=True, searchReplace=("L_", "R_"))
      

    def L_ik_leg(self):
        # find out if there already has been made and Fk leg setup
        if cmds.objExists("L_Ik_foot_Ctl"):
            print "there is already this setup"
            return 
        
        # create the Ik arm by duplicating
        ik_leg = cmds.duplicate('L_femur_jnt', rc=True)

        cmds.listRelatives(ik_leg, ad=True)

        ik_femur = cmds.rename(ik_leg[0], 'L_Ik_femur_jnt')
        ik_knee = cmds.rename(ik_leg[1], 'L_Ik_knee_jnt')
        ik_ankle = cmds.rename(ik_leg[2], 'L_Ik_ankle_jnt')
        ik_ball = cmds.rename(ik_leg[3], 'L_Ik_ball_jnt')
        ik_toe = cmds.rename(ik_leg[4], 'L_Ik_toe_jnt')
        # create Ik Rig
        # create Rotate ikHandle between the femur and ankle
        ik_hdl_femur = cmds.ikHandle(n='L_femurAnkle_Ikh', sj=ik_femur, ee=ik_ankle, sol='ikRPsolver', p=2, w=1)
        # create Single ikHandle between the ankle and ball
        ik_hdl_ball = cmds.ikHandle(n='L_ankleBall_Ikh', sj=ik_ankle, ee=ik_ball, sol='ikSCsolver', p=2, w=1)
        # create Single ikHandle between the ball and toe
        ik_hdl_toe = cmds.ikHandle(n='L_ballToe_Ikh', sj=ik_ball, ee=ik_toe, sol='ikSCsolver', p=2, w=1)
        # find the worldspace ws translate position of the wrist
        pos_trans_ankle_ik = cmds.xform(ik_ankle, q=True, t=True, ws=True)
        pos_trans_ball_ik = cmds.xform(ik_ball, q=True, t=True, ws=True)
        pos_trans_toe_ik = cmds.xform(ik_toe, q=True, t=True, ws=True)
        # find the worldspace ws orientation position of the wrist
        pos_orient_ankle_ik = cmds.xform(ik_ankle, q=True, ro=True, ws=True)
        pos_orient_ball_ik = cmds.xform(ik_ball, q=True, ro=True, ws=True)
        pos_orient_toe_ik = cmds.xform(ik_toe, q=True, ro=True, ws=True)
        # create the empty group
        ik_grp = cmds.group(em=True, n='L_Ik_foot_Grp')
        # create the empty extra Null group
        ik_Null = cmds.group(em=True, n='L_Ik_foot_Null')
        # parent the null to the group
        cmds.parent(ik_Null, ik_grp)
        # create the control
        ik_foot_ctl = cmds.circle(n='L_Ik_foot_Ctl', nr=(0, 0, 1), c=(0, 0, 0), r=2.0, ch=False)
        ik_offset_foot_ctl = cmds.circle(n='L_Ik_offsetFoot_Ctl', nr=(0, 0, 1), c=(0, 0, 0), r=2.25, ch=False)
        # hide shape node
        j= cmds.listHistory(ik_foot_ctl, af=1)
        print j
        for things in j:
            print things
            cmds.setAttr("{0}.isHistoricallyInteresting".format(things),0)
        # parent the control to the group
        cmds.parent(ik_offset_foot_ctl, ik_foot_ctl)
        cmds.parent(ik_foot_ctl, ik_Null)
        # change rotation order for offset control
        cmds.setAttr(ik_foot_ctl[0]+'.rotateOrder', k=True, lock=True)
        cmds.setAttr(ik_offset_foot_ctl[0]+'.rotateOrder', 2)
        cmds.setAttr(ik_offset_foot_ctl[0]+'.rotateOrder', k=True, lock=True)
        # move the group to the wrist
        cmds.xform(ik_grp, t=pos_trans_ankle_ik, ws=True)
        # orient the group to the wrist
        cmds.rotate(-90, -90, -90, ik_grp, relative=True)
        cmds.rotate(90, 90, 0, ik_foot_ctl, relative=True)
        # freeze ik ctl's
        cmds.makeIdentity(ik_foot_ctl, r=True, a=True)
        # clear history of the control's
        cmds.delete(ik_foot_ctl, ch=True)
        # move the group to the wrist
        cmds.xform(ik_grp, t=pos_trans_ankle_ik, ws=True)
        # create groups for the ikhandles
        peel_heel_grp = cmds.group(em=True, n="L_peelheel_Grp")
        toe_tap_grp = cmds.group(em=True, n="L_toeTap_Grp")
        toe_tap_footRoll_grp = cmds.group(em=True, n="L_toeTap_footRoll_ball_Grp")
        stand_tip_grp = cmds.group(em=True, n="L_standTip_Grp")
        stand_tip_footRoll_grp = cmds.group(em=True, n="L_standTip_footRoll_Toe_Grp")
        heel_pivot_grp = cmds.group(em=True, n="L_heelPivot_Grp")
        heel_pivot_footRoll_grp = cmds.group(em=True, n="L_heelPivot_footRoll_heel_Grp")
        twist_heel_grp = cmds.group(em=True, n="L_twistHeel_Grp")
        twist_ball_grp = cmds.group(em=True, n="L_twistBall_Grp")
        twist_toe_grp = cmds.group(em=True, n="L_twistToe_Grp")
        left_bank_grp = cmds.group(em=True, n="L_leftBank_Grp")
        right_bank_grp = cmds.group(em=True, n="L_rightBank_Grp")
        foot_attr_grp = cmds.group(em=True, n="L_footAttr_Grp")
        gimbal_grp = cmds.group(em=True, n="L_foot_gimbal_Grp")
        zeroOut_grp = cmds.group(em=True, n="L_foot_zero_Grp")
        # place the groups
        cmds.xform(peel_heel_grp, t=pos_trans_ball_ik, ws=True)
        cmds.xform(toe_tap_grp, t=pos_trans_ball_ik, ws=True)
        cmds.xform(stand_tip_grp, t=pos_trans_toe_ik, ws=True)
        cmds.xform(heel_pivot_grp, t=pos_trans_ankle_ik, ws=True)
        cmds.xform(toe_tap_footRoll_grp, t=pos_trans_ball_ik, ws=True)
        cmds.xform(stand_tip_footRoll_grp, t=pos_trans_toe_ik, ws=True)
        cmds.xform(heel_pivot_footRoll_grp, t=pos_trans_ankle_ik, ws=True)
        cmds.xform(twist_heel_grp, t=pos_trans_ankle_ik, ws=True)
        cmds.xform(twist_ball_grp, t=pos_trans_ball_ik, ws=True)
        cmds.xform(twist_toe_grp, t=pos_trans_toe_ik, ws=True)
        cmds.xform(left_bank_grp, t=pos_trans_ball_ik, ws=True)
        cmds.xform(right_bank_grp, t=pos_trans_ball_ik, ws=True)
        cmds.xform(foot_attr_grp, t=pos_trans_ball_ik, ws=True)
        cmds.xform(gimbal_grp, t=pos_trans_ankle_ik, ws=True)
        cmds.xform(zeroOut_grp, t=pos_trans_ankle_ik, ws=True)
        # parent the groups together to make the correct movement
        cmds.parent(toe_tap_grp, stand_tip_grp)
        cmds.parent(toe_tap_footRoll_grp, stand_tip_grp)
        cmds.parent(peel_heel_grp, toe_tap_footRoll_grp)
        cmds.parent(stand_tip_grp, stand_tip_footRoll_grp)
        cmds.parent(stand_tip_footRoll_grp, heel_pivot_grp)
        cmds.parent(heel_pivot_grp, heel_pivot_footRoll_grp)
        cmds.parent(heel_pivot_footRoll_grp, twist_heel_grp)
        cmds.parent(twist_heel_grp, twist_ball_grp)
        cmds.parent(twist_ball_grp, twist_toe_grp)
        cmds.parent(twist_toe_grp, left_bank_grp)
        cmds.parent(left_bank_grp, right_bank_grp)
        cmds.parent(right_bank_grp, foot_attr_grp)
        cmds.parent(foot_attr_grp, gimbal_grp)
        cmds.parent(gimbal_grp, zeroOut_grp)
        # parent the ikhandles to the groups
        cmds.parent(ik_hdl_femur[0], peel_heel_grp)
        cmds.parent(ik_hdl_ball[0], toe_tap_grp)
        cmds.parent(ik_hdl_toe[0], toe_tap_grp)
        # parent the Ikhandle GROUP to the controller
        cmds.parent(zeroOut_grp, ik_offset_foot_ctl)
        # create the attributes for the foot control
        cmds.setAttr(ik_foot_ctl[0]+'.visibility', e=True, k=False)
        cmds.setAttr(ik_foot_ctl[0]+'.scaleX', e=True, k=False, lock=True)
        cmds.setAttr(ik_foot_ctl[0]+'.scaleY', e=True, k=False, lock=True)
        cmds.setAttr(ik_foot_ctl[0]+'.scaleZ', e=True, k=False, lock=True)
        # add gimbal X and set the gimbal attr keyable and editable
        self.util.gimbalX_attribute(object=ik_foot_ctl[0])
        self.util.gimbalY_attribute(object=ik_foot_ctl[0])
        self.util.gimbalZ_attribute(object=ik_foot_ctl[0])
        # break __ ___________
        cmds.addAttr(ik_foot_ctl, ln='seperator1', nn='__', at='enum', en='__________')
        cmds.setAttr(ik_foot_ctl[0]+'.seperator1', e=True, k=True, lock=True)
        # PoleVector control
        cmds.addAttr(ik_foot_ctl, ln='pvControl', at='enum', en='off:on')
        cmds.setAttr(ik_foot_ctl[0]+'.pvControl', e=True, k=True)
        # Leg twist
        cmds.addAttr(ik_foot_ctl, ln='legTwist', at='double', dv=0)
        cmds.setAttr(ik_foot_ctl[0]+'.legTwist', e=True, k=True)
        # offset vis
        cmds.addAttr(ik_foot_ctl, ln='offsetVis', at='enum', en='off:on')
        cmds.setAttr(ik_foot_ctl[0]+'.offsetVis', e=True, k=True)
        # break __ ___________
        cmds.addAttr(ik_foot_ctl, ln='seperator2', nn='__', at='enum', en='__________')
        cmds.setAttr(ik_foot_ctl[0]+'.seperator2', e=True, k=True, lock=True)
        # foot follow
        # Nodes for the space switch space_foot_follow_world_cnd
        self.util.space_foot_follow(object=ik_foot_ctl[0])
        self.util.space_foot_follow_world_cnd(object=ik_foot_ctl[0], name="_footSpace_world_Cnd")
        self.util.space_foot_follow_hip_cnd(object=ik_foot_ctl[0], name="_footSpace_hip_Cnd")
        self.util.space_foot_follow_cog_cnd(object=ik_foot_ctl[0], name="_footSpace_cog_Cnd")       
        world_space = ik_foot_ctl[0]+'_footSpace_world_Cnd'
        hip_space = ik_foot_ctl[0]+'_footSpace_hip_Cnd'
        cog_space = ik_foot_ctl[0]+'_footSpace_cog_Cnd'
        # break __ ___________
        cmds.addAttr(ik_foot_ctl, ln='seperator3', nn='__', at='enum', en='__________')
        cmds.setAttr(ik_foot_ctl[0]+'.seperator3', e=True, k=True, lock=True)
        # foot roll, Toe break, Toe straight
        cmds.addAttr(ik_foot_ctl, ln='footRoll', at='double', dv=0)
        cmds.addAttr(ik_foot_ctl, ln='toeBreak', at='double', dv=20)
        cmds.addAttr(ik_foot_ctl, ln='toeStraight', at='double', dv=70)
        cmds.setAttr(ik_foot_ctl[0]+'.footRoll', e=True, k=True)
        cmds.setAttr(ik_foot_ctl[0]+'.toeBreak', e=True, k=True)
        cmds.setAttr(ik_foot_ctl[0]+'.toeStraight', e=True, k=True)
        # break __ ___________
        cmds.addAttr(ik_foot_ctl, ln='seperator4', nn='__', at='enum', en='__________')
        cmds.setAttr(ik_foot_ctl[0]+'.seperator4', e=True, k=True, lock=True)
        # Heel up / heel rotate up/down
        cmds.addAttr(ik_foot_ctl, ln='heelPivot', at='double', dv=0)
        cmds.setAttr(ik_foot_ctl[0]+'.heelPivot', e=True, k=True)
        # Peel heel / heel up
        cmds.addAttr(ik_foot_ctl, ln='heelUp', at='double', dv=0)
        cmds.setAttr(ik_foot_ctl[0]+'.heelUp', e=True, k=True)
        # Stand Tip
        cmds.addAttr(ik_foot_ctl, ln='standTip', at='double', dv=0)
        cmds.setAttr(ik_foot_ctl[0]+'.standTip', e=True, k=True)
        # Toe Tap
        cmds.addAttr(ik_foot_ctl, ln='toeTap', at='double', dv=0)
        cmds.setAttr(ik_foot_ctl[0]+'.toeTap', e=True, k=True)
        # Foot Bank
        cmds.addAttr(ik_foot_ctl, ln='footBank', at='double', dv=0)
        cmds.setAttr(ik_foot_ctl[0]+'.footBank', e=True, k=True)
        # Twist Heel
        cmds.addAttr(ik_foot_ctl, ln='twistHeel', at='double', dv=0)
        cmds.setAttr(ik_foot_ctl[0]+'.twistHeel', e=True, k=True)
        # Twist Ball
        cmds.addAttr(ik_foot_ctl, ln='twistBall', at='double', dv=0)
        cmds.setAttr(ik_foot_ctl[0]+'.twistBall', e=True, k=True)
        # Twist Toe
        cmds.addAttr(ik_foot_ctl, ln='twistToe', at='double', dv=0)
        cmds.setAttr(ik_foot_ctl[0]+'.twistToe', e=True, k=True)
        # create the Nodes for connecting all the attributes to the control
        # Nodes for foot roll - multiplyDivide and Clamp node

        """
        world_space = cmds.shadingNode('condition', n='L_Ik_footSpace_world_Cnd', au=True)
        hip_space = cmds.shadingNode('condition', n='L_Ik_footSpace_hip_Cnd', au=True)
        cog_space = cmds.shadingNode('condition', n='L_Ik_footSpace_cog_Cnd', au=True)
        """
        cmds.setAttr(world_space+'.colorIfFalseR', 0)
        cmds.setAttr(hip_space+'.colorIfFalseR', 0)
        cmds.setAttr(cog_space+'.colorIfFalseR', 0)
        cmds.setAttr(world_space+'.colorIfTrueR', 1)
        cmds.setAttr(hip_space+'.colorIfTrueR', 1)
        cmds.setAttr(cog_space+'.colorIfTrueR', 1)
        cmds.setAttr(world_space+'.secondTerm', 2)
        cmds.setAttr(hip_space+'.secondTerm', 1)
        cmds.setAttr(cog_space+'.secondTerm', 0)
        # heel
        heel_rev_cnd = cmds.shadingNode('condition', n='L_heelRevFoot_Cnd', au=True)
        cmds.setAttr(heel_rev_cnd+'.operation', 4)
        cmds.setAttr(heel_rev_cnd+'.colorIfFalseR', 0)
        # ball
        ball_rev_sr = cmds.shadingNode('setRange', n='L_ballRevFoot_Sr', au=True)
        ball_rev_pma = cmds.shadingNode('plusMinusAverage', n='L_ballRevFoot_Pma', au=True)
        cmds.setAttr(ball_rev_pma+'.operation', 2)
        cmds.setAttr(ball_rev_pma+'.input1D[0]', 1)
        ball_rev_cnd = cmds.shadingNode('condition', n='L_ballRevFoot_Cnd', au=True)
        ball_rev_md = cmds.shadingNode('multiplyDivide', n='L_ballRevFoot_footRoll_Md', au=True)
        cmds.setAttr(ball_rev_md+'.operation', 1)
        cmds.setAttr(ball_rev_cnd+'.operation', 2)
        cmds.setAttr(ball_rev_cnd+'.colorIfFalseR', 0)
        # toe
        toe_rev_sr = cmds.shadingNode('setRange', n='L_tipRevFoot_Sr', au=True)
        toe_rev_md = cmds.shadingNode('multiplyDivide', n='L_tipRoll_footRoll_Md', au=True)
        # Nodes for Heel up - multiplyDivide and Clamp node
        heel_up_md = cmds.shadingNode('multiplyDivide', n='L_heelUp_Md', au=True, )
        heel_up_clp = cmds.shadingNode('clamp', n='L_heelUp_Clp', au=True)
        cmds.setAttr(heel_up_md+'.input2X', 5)
        cmds.setAttr(heel_up_clp+'.minR', -50)
        cmds.setAttr(heel_up_clp+'.maxR', 50)
        # nodes for peel heel - multiplyDivide and Clamp node
        peel_heel_md = cmds.shadingNode('multiplyDivide', n='L_peelHeel_Md', au=True, )
        peel_heel_clp = cmds.shadingNode('clamp', n='L_peelHeel_Clp', au=True)
        cmds.setAttr(peel_heel_md+'.input2X', 9)
        cmds.setAttr(peel_heel_clp+'.minR', -90)
        cmds.setAttr(peel_heel_clp+'.maxR', 90)
        # node for stand tip - multiplyDivide and Clamp node
        stand_tip_md = cmds.shadingNode('multiplyDivide', n='L_standTip_Md', au=True, )
        stand_tip_clp = cmds.shadingNode('clamp', n='L_standTip_Clp', au=True)
        cmds.setAttr(stand_tip_md+'.input2X', 9)
        cmds.setAttr(stand_tip_clp+'.minR', -120)
        cmds.setAttr(stand_tip_clp+'.maxR', 90)
        # nodes for toe tap - multiplyDivide and Clamp node
        toe_tap_md = cmds.shadingNode('multiplyDivide', n='L_toeTap_Md', au=True, )
        toe_tap_clp = cmds.shadingNode('clamp', n='L_toeTap_Clp', au=True)
        cmds.setAttr(toe_tap_md+'.input2X', 9)
        cmds.setAttr(toe_tap_clp+'.minR', -90)
        cmds.setAttr(toe_tap_clp+'.maxR', 90)
        # nodes for foot bank - multiplyDivide and Clamp node
        foot_bank_md = cmds.shadingNode('multiplyDivide', n='L_footBank_Md', au=True, )
        l_foot_bank_clp = cmds.shadingNode('clamp', n='L_leftFootBank_Clp', au=True)
        r_foot_bank_clp = cmds.shadingNode('clamp', n='L_rightFootBank_Clp', au=True)
        cmds.setAttr(foot_bank_md+'.input2X', 9)
        cmds.setAttr(foot_bank_md+'.input2Y', 9)
        cmds.setAttr(l_foot_bank_clp+'.minR', -90)
        cmds.setAttr(r_foot_bank_clp+'.maxR', 90)
        # nodes for twist heel - multiplyDivide and Clamp node
        heel_twist_md = cmds.shadingNode('multiplyDivide', n='L_twistHeel_Md', au=True, )
        heel_twist_clp = cmds.shadingNode('clamp', n='L_twistHeel_Clp', au=True)
        cmds.setAttr(heel_twist_md+'.input2X', 9)
        cmds.setAttr(heel_twist_clp+'.minR', -90)
        cmds.setAttr(heel_twist_clp+'.maxR', 90)
        # nodes for twist ball - multiplyDivide and Clamp node
        ball_twist_md = cmds.shadingNode('multiplyDivide', n='L_twistBall_Md', au=True, )
        ball_twist_clp = cmds.shadingNode('clamp', n='L_twistBall_Clp', au=True)
        cmds.setAttr(ball_twist_md+'.input2X', 9)
        cmds.setAttr(ball_twist_clp+'.minR', -90)
        cmds.setAttr(ball_twist_clp+'.maxR', 90)
        # nodes for twist toe - multiplyDivide and Clamp node
        toe_twist_md = cmds.shadingNode('multiplyDivide', n='L_twistToe_Md', au=True, )
        toe_twist_clp = cmds.shadingNode('clamp', n='L_twistToe_Clp', au=True)
        cmds.setAttr(toe_twist_md+'.input2X', 9)
        cmds.setAttr(toe_twist_clp+'.minR', -90)
        cmds.setAttr(toe_twist_clp+'.maxR', 90)
        # Connecting the nodes to the groups, and connecting groups
        # Gimbal
        cmds.connectAttr(ik_foot_ctl[0]+'.gimbalX', gimbal_grp+'.rotateX')
        cmds.connectAttr(ik_foot_ctl[0]+'.gimbalY', gimbal_grp+'.rotateY')
        cmds.connectAttr(ik_foot_ctl[0]+'.gimbalZ', gimbal_grp+'.rotateZ')
        # PV control - leg twist
        cmds.connectAttr(ik_foot_ctl[0]+'.legTwist', ik_hdl_femur[0]+'.twist')
        # offset visibility
        cmds.connectAttr(ik_foot_ctl[0]+'.offsetVis', ik_offset_foot_ctl[0]+'.lodVisibility')
        #setRange
        cmds.setAttr(toe_rev_sr+'.maxX', 1)
        cmds.setAttr(ball_rev_sr+'.maxX', 1)
        # foot follow - create groups if not already created and parent them under
        # the skeletons joints
        # create groups
        self.util.create_space_groups(name="hip_Spa")
        self.util.create_space_groups(name="cog_Spa")
        self.util.create_space_groups(name="world_Spa")
        # move groups to the joints or controls, first get the position(xform)
        
        if cmds.objExists ("C_pelvis_jnt"):
            pelvis_space = 'C_pelvis_jnt'
            root_space = 'C_root'
            pelvis_pos = cmds.xform(pelvis_space, query=True, translation=True, worldSpace=True)
            root_pos = cmds.xform(root_space, query=True, translation=True, worldSpace=True)
            cmds.xform("hip_Spa", translation=pelvis_pos, worldSpace=True)
            cmds.xform("cog_Spa", translation=root_pos, worldSpace=True)
            cmds.parent("hip_Spa", 'C_pelvis_jnt')
            cmds.parent("cog_Spa", 'C_root')
            
        else:
            cmds.parent("hip_Spa", "space_Grp")
            cmds.parent("cog_Spa", "space_Grp")
            print "Remember to place the hip_Spa and cog_Spa pivot correctly" 
            print "and parent it correctly"


        # parent the group to the nodes 

        # parentConstraint and setup nodes for switching between the space's
        cmds.parentConstraint('hip_Spa', "cog_Spa", "world_Spa", ik_Null, maintainOffset=True)
        # combine ctl to nodes
        cmds.connectAttr(ik_foot_ctl[0]+'.footFollow', world_space+'.firstTerm')
        cmds.connectAttr(ik_foot_ctl[0]+'.footFollow', hip_space+'.firstTerm')
        cmds.connectAttr(ik_foot_ctl[0]+'.footFollow', cog_space+'.firstTerm')
        cmds.connectAttr(world_space+'.outColorR', ik_Null+'_parentConstraint1.world_SpaW2')
        cmds.connectAttr(hip_space+'.outColorR', ik_Null+'_parentConstraint1.cog_SpaW1')
        cmds.connectAttr(cog_space+'.outColorR', ik_Null+'_parentConstraint1.hip_SpaW0')
        # Connect footRoll control to nodes
        # First string - Heel 
        cmds.connectAttr(ik_foot_ctl[0]+'.footRoll', heel_rev_cnd+'.colorIfTrueR')
        cmds.connectAttr(ik_foot_ctl[0]+'.footRoll', heel_rev_cnd+'.firstTerm')
        cmds.connectAttr(heel_rev_cnd+'.outColorR', heel_pivot_footRoll_grp+'.rotateX')
        # Second string - Ball
        cmds.connectAttr(ik_foot_ctl[0]+'.footRoll', ball_rev_sr+'.valueX')
        cmds.connectAttr(ik_foot_ctl[0]+'.footRoll', ball_rev_cnd+'.colorIfTrueR')
        cmds.connectAttr(ik_foot_ctl[0]+'.footRoll', ball_rev_cnd+'.firstTerm')
        cmds.connectAttr(ik_foot_ctl[0]+'.toeStraight', ball_rev_sr+'.oldMaxX')
        cmds.connectAttr(ik_foot_ctl[0]+'.toeBreak', ball_rev_sr+'.oldMinX')
        cmds.connectAttr(ball_rev_sr+'.outValueX', ball_rev_pma+'.input1D[1]')
        cmds.connectAttr(ball_rev_pma+'.output1D', ball_rev_md+'.input2X') 
        cmds.connectAttr(ball_rev_cnd+'.outColorR', ball_rev_md+'.input1X') 
        cmds.connectAttr(ball_rev_md+'.outputX', toe_tap_footRoll_grp+'.rotateX')
        # Third string - Toe
        cmds.connectAttr(ik_foot_ctl[0]+'.footRoll', toe_rev_sr+'.valueX')
        cmds.connectAttr(ik_foot_ctl[0]+'.footRoll', toe_rev_md+'.input1X')
        cmds.connectAttr(ik_foot_ctl[0]+'.toeBreak', toe_rev_sr+'.oldMinX')
        cmds.connectAttr(ik_foot_ctl[0]+'.toeStraight', toe_rev_sr+'.oldMaxX')
        cmds.connectAttr(toe_rev_sr+'.outValueX', toe_rev_md+'.input2X')
        cmds.connectAttr(toe_rev_md+'.outputX', stand_tip_footRoll_grp+'.rotateX')
        # Heel Pivot connect
        cmds.connectAttr(ik_foot_ctl[0]+'.heelPivot', heel_pivot_grp+'.rotateX')
        # Heel Up connect
        cmds.connectAttr(ik_foot_ctl[0]+'.heelUp', peel_heel_grp+'.rotateX')
        # Stand Tip connect
        cmds.connectAttr(ik_foot_ctl[0]+'.standTip', stand_tip_grp+'.rotateX')
        # Toe Tap connect
        cmds.connectAttr(ik_foot_ctl[0]+'.toeTap', toe_tap_grp+'.rotateX')
        # Foot Bank connect
        cmds.connectAttr(ik_foot_ctl[0]+'.footBank', left_bank_grp+'.rotateZ')
        cmds.connectAttr(ik_foot_ctl[0]+'.footBank', right_bank_grp+'.rotateZ')
        # Twist Heel connect
        cmds.connectAttr(ik_foot_ctl[0]+'.twistHeel', twist_heel_grp+'.rotateY')
        # Twist Ball connect
        cmds.connectAttr(ik_foot_ctl[0]+'.twistBall', twist_ball_grp+'.rotateY')
        # Twist Toe connect
        cmds.connectAttr(ik_foot_ctl[0]+'.twistToe', twist_toe_grp+'.rotateY')
        # print remember to correct the pivot position
        print "______________ATTENSION________________"
        print "You need to manual set the L_heel_pivot_Grp pivot to the heel"
        print "Also set the left and right foot bank pivot position"
         
        # Create Pole vec

        # getting controller to control the orient of the wrist
        cmds.orientConstraint('L_Ik_foot_Ctl', 'L_Ik_ankle_jnt', mo=True)
        # create a locator as a poleVector
        pv_loc = cmds.spaceLocator(n='L_leg_poleVec_Loc')
        # create a group as the group for a poleVector
        pv_grp = cmds.group(em=True, n='L_leg_poleVec_Grp')
        # parent locator to the group
        cmds.parent(pv_loc, pv_grp)
        # place the group between the shoulder and the wrist
        cmds.pointConstraint(ik_femur, ik_ankle, pv_grp)
        # aim the locator twoards the knee
        cmds.aimConstraint(ik_knee, pv_grp, aim=(1, 0, 0), u=(0, 1, 0))
        # delete the constraints
        cmds.delete(pv_grp+'_pointConstraint1')
        cmds.delete(pv_grp+'_aimConstraint1')
        # place the locater out from the knee using the X axis trans
        cmds.move(20, pv_loc, z=True, a=True)
        # create controller for the polevector
        ik_knee_ctl = cmds.curve(n='L_Ik_knee_Ctl', d = 1,p = [[0.5000000000000019, -0.250000000000001, 5.551115123125783e-17], [0.5000000000000019, 0.249999999999999, -5.551115123125783e-17],
        [0.25000000000000183, 0.24999999999999906, -5.551115123125783e-17],
        [0.25000000000000183, 0.4999999999999991, -1.1102230246251565e-16], [-0.2499999999999983, 0.49999999999999917, -1.1102230246251565e-16], [-0.2499999999999983, 0.2499999999999992, -5.551115123125783e-17],
        [-0.4999999999999984, 0.24999999999999922, -5.551115123125783e-17], [-0.4999999999999984, -0.2500000000000008, 5.551115123125783e-17], [-0.2499999999999983, -0.25000000000000083, 5.551115123125783e-17],
        [-0.2499999999999983, -0.5000000000000009, 1.1102230246251565e-16], [0.25000000000000183, -0.5000000000000009, 1.1102230246251565e-16], [0.25000000000000183, -0.25000000000000094, 5.551115123125783e-17],
        [0.5000000000000019, -0.250000000000001, 5.551115123125783e-17]],k = (0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0, 11.0, 12.0))
        cmds.setAttr(ik_knee_ctl+".scaleX", 3)
        cmds.setAttr(ik_knee_ctl+".scaleY", 3)
        cmds.setAttr(ik_knee_ctl+".scaleZ", 3)
        # move parent the controller to the locator locatieon
        cmds.pointConstraint(pv_loc, ik_knee_ctl)
        # delete pointConstraint from controller
        cmds.delete(ik_knee_ctl+'_pointConstraint1')
        # parent controller to grp
        cmds.parent(ik_knee_ctl, pv_grp)
        # freeze orientation on controller
        cmds.makeIdentity(ik_knee_ctl, apply=True, translate=True, rotate=False, scale=False)
        # delete history on ctl
        cmds.delete(ik_knee_ctl, ch=True)
        # parent poleVEc to controller
        cmds.parent(pv_loc, ik_knee_ctl)
        # connect the polevector constraint to the ikhandle and the locator
        cmds.poleVectorConstraint(pv_loc, 'L_femurAnkle_Ikh')
        # hide locator
        cmds.hide(pv_loc)
        # hide scale from ik control
        cmds.setAttr(ik_foot_ctl[0]+'.scaleX', keyable=False, ch=False, lock=True)
        cmds.setAttr(ik_foot_ctl[0]+'.scaleY', keyable=False, ch=False, lock=True)
        cmds.setAttr(ik_foot_ctl[0]+'.scaleZ', keyable=False, ch=False, lock=True)
        cmds.setAttr(ik_foot_ctl[0]+'.visibility', keyable=False, ch=False, lock=True)
        # hide scale from ik offset control
        cmds.setAttr(ik_offset_foot_ctl[0]+'.scaleX', keyable=False, ch=False, lock=True)
        cmds.setAttr(ik_offset_foot_ctl[0]+'.scaleY', keyable=False, ch=False, lock=True)
        cmds.setAttr(ik_offset_foot_ctl[0]+'.scaleZ', keyable=False, ch=False, lock=True)
        cmds.setAttr(ik_offset_foot_ctl[0]+'.visibility', keyable=False, ch=False, lock=True)
        # hide rotate and scale from knee ik control
        cmds.setAttr(ik_knee_ctl+'.rotateX', keyable=False, ch=False, lock=True)
        cmds.setAttr(ik_knee_ctl+'.rotateY', keyable=False, ch=False, lock=True)
        cmds.setAttr(ik_knee_ctl+'.rotateZ', keyable=False, ch=False, lock=True)
        cmds.setAttr(ik_knee_ctl+'.scaleX', keyable=False, ch=False, lock=True)
        cmds.setAttr(ik_knee_ctl+'.scaleY', keyable=False, ch=False, lock=True)
        cmds.setAttr(ik_knee_ctl+'.scaleZ', keyable=False, ch=False, lock=True)
        cmds.setAttr(ik_knee_ctl+'.visibility', keyable=False, ch=False, lock=True)
        # delete history on the ik control
        cmds.delete(ik_foot_ctl, ch=True)
        # add the attribute for space switch
        
        # place them in the group hierarchy if there is one
        placeInGroup = cmds.ls('main_Grp')
        # if it is there parent them respectly
        if placeInGroup:
            cmds.parent('L_Ik_foot_Grp', 'L_Ik_Grp')
            cmds.parent('L_leg_poleVec_Grp', 'L_Ik_Grp')    
        else:
            return 


    def L_fk_leg(self):
        # find out if there already has been made and Fk leg setup
        if cmds.objExists("L_Fk_femur_Ctl"):
            print "there is already this setup"
            return                  
        
        # create the Fk arm by duplicating
        fk_leg = cmds.duplicate('L_femur_jnt', renameChildren=True)
    
        cmds.listRelatives(fk_leg, ad=True)
    
        fkFemur = cmds.rename(fk_leg[0], 'L_Fk_femur_jnt')
        fkKnee = cmds.rename(fk_leg[1], 'L_Fk_knee_jnt')
        fkAnkle = cmds.rename(fk_leg[2], 'L_Fk_ankle_jnt')
        fkBall = cmds.rename(fk_leg[3], 'L_Fk_ball_jnt')
        fkToe = cmds.rename(fk_leg[4], 'L_Fk_toe_jnt')
        # create Fk Rig
        # find the worldposition ws translate position of shoulder, knee and wrist
        posTransFemur = cmds.xform(fkFemur, query=True, translation=True, worldSpace=True)
        posTransKnee = cmds.xform(fkKnee, query=True, translation=True, worldSpace=True)
        posTransAnkle = cmds.xform(fkAnkle, q=True, translation=True, worldSpace=True)
        posTransBall = cmds.xform(fkBall, query=True, translation=True, worldSpace=True)
        # find the worldposition ws orient position of shoulder, knee and wrist
        posOrientFemur = cmds.xform(fkFemur, query=True, rotation=True, worldSpace=True)
        posOrientKnee = cmds.xform(fkKnee, query=True, rotation=True, worldSpace=True)
        posOrientAnkle = cmds.xform(fkAnkle, query=True, rotation=True, worldSpace=True)
        posOrientBall = cmds.xform(fkBall, query=True, rotation=True, worldSpace=True)
        # create a group for each limb (3)
        lFkFemurGrp = cmds.group(empty=True, n='L_Fk_femur_Grp')
        lFkKneeGrp = cmds.group(empty=True, n='L_Fk_knee_Grp')
        lFkAnkleGrp = cmds.group(empty=True, n='L_Fk_ankle_Grp')
        lFkBallGrp = cmds.group(empty=True, n='L_Fk_ball_Grp')
        # create a controller for each limb (3)
        lFemurCtl = cmds.circle(n='L_Fk_femur_Ctl', normal=(0, 0, 1), center=(0, 0, 0), radius=2.5, ch=False)
        lOffsetFemurCtl = cmds.circle(n='L_Fk_offsetFemur_Ctl', normal=(0, 0, 1), center=(0, 0, 0), radius=3.0, ch=False)
        lKneeCtl = cmds.circle(n='L_Fk_knee_Ctl', normal=(0, 0, 1), center=(0, 0, 0), radius=2.5, ch=False)
        lOffsetKneeCtl = cmds.circle(n='L_Fk_offsetKnee_Ctl', normal=(0, 0, 1), center=(0, 0, 0), radius=3.0, ch=False)
        lAnkleCtl = cmds.circle(n='L_Fk_ankle_Ctl', normal=(0, 0, 1), center=(0, 0, 0), radius=2.5, ch=False)
        lOffsetAnkleCtl = cmds.circle(n='L_Fk_offsetAnkle_Ctl', normal=(0, 0, 1), center=(0, 0, 0), radius=3.0, ch=False)
        lBallCtl = cmds.circle(n='L_Fk_ball_Ctl', normal=(0, 0, 1), center=(0, 0, 0), radius=2.5, ch=False)
        lOffsetBallCtl = cmds.circle(n='L_Fk_offsetBall_Ctl', normal=(0, 0, 1), center=(0, 0, 0), radius=3.0, ch=False)
        # parent the control to the offset control
        cmds.parent(lOffsetFemurCtl, lFemurCtl)
        cmds.parent(lOffsetKneeCtl, lKneeCtl)
        cmds.parent(lOffsetAnkleCtl, lAnkleCtl)
        cmds.parent(lOffsetBallCtl, lBallCtl)
        # parent the controller to the groups
        cmds.parent(lFemurCtl, lFkFemurGrp)
        cmds.parent(lKneeCtl, lFkKneeGrp)
        cmds.parent(lAnkleCtl, lFkAnkleGrp)
        cmds.parent(lBallCtl, lFkBallGrp)
        # change rotation order for all the offset control
        cmds.setAttr(lOffsetFemurCtl[0]+".rotateOrder", k=True, lock=True)
        cmds.setAttr(lFemurCtl[0]+".rotateOrder", 2)
        cmds.setAttr(lFemurCtl[0]+".rotateOrder", k=True, lock=True)
        cmds.setAttr(lOffsetKneeCtl[0]+".rotateOrder", k=True, lock=True)
        cmds.setAttr(lKneeCtl[0]+".rotateOrder", 2)
        cmds.setAttr(lKneeCtl[0]+".rotateOrder", k=True, lock=True)
        cmds.setAttr(lOffsetAnkleCtl[0]+".rotateOrder", k=True, lock=True)
        cmds.setAttr(lAnkleCtl[0]+".rotateOrder", 2)
        cmds.setAttr(lAnkleCtl[0]+".rotateOrder", k=True, lock=True)
        cmds.setAttr(lOffsetBallCtl[0]+".rotateOrder", k=True, lock=True)
        cmds.setAttr(lBallCtl[0]+".rotateOrder", 2)
        cmds.setAttr(lBallCtl[0]+".rotateOrder", k=True, lock=True)
        # add gimbal X,Y,Z and set the gimbal attr keyable and editable using the gimbal_attribute function
        self.util.gimbalX_attribute(object=lFemurCtl[0])
        self.util.gimbalY_attribute(object=lFemurCtl[0])
        self.util.gimbalZ_attribute(object=lFemurCtl[0])
        
        self.util.gimbalZ_attribute(object=lKneeCtl[0])
         
        self.util.gimbalX_attribute(object=lAnkleCtl[0]) 
        self.util.gimbalY_attribute(object=lAnkleCtl[0])
        self.util.gimbalZ_attribute(object=lAnkleCtl[0])
         
        self.util.gimbalZ_attribute(object=lBallCtl[0])
        # zero out gimbal
        l_femurZeroOut_grp = cmds.group(em=True, n="L_femur_zero_Grp")
        cmds.xform(l_femurZeroOut_grp, t=posTransFemur, ws=True)
        cmds.xform(l_femurZeroOut_grp, ro=posOrientFemur, ws=True)
        l_kneeZeroOut_grp = cmds.group(em=True, n="L_knee_zero_Grp")
        cmds.xform(l_kneeZeroOut_grp, t=posTransKnee, ws=True)
        cmds.xform(l_kneeZeroOut_grp, ro=posOrientKnee, ws=True)
        l_ankleZeroOut_grp = cmds.group(em=True, n="L_ankle_zero_Grp")
        cmds.xform(l_ankleZeroOut_grp, t=posTransAnkle, ws=True)
        cmds.xform(l_ankleZeroOut_grp, ro=posOrientAnkle, ws=True)
        l_ballZeroOut_grp = cmds.group(em=True, n="L_ball_zero_Grp")
        cmds.xform(l_ballZeroOut_grp, t=posTransBall, ws=True)
        cmds.xform(l_ballZeroOut_grp, ro=posOrientBall, ws=True)

        # create gimbal groups
        l_femur_gimbal_grp = cmds.group(em=True, n="L_femur_gimbal_Grp")
        cmds.xform(l_femur_gimbal_grp, t=posTransFemur, ws=True)
        cmds.xform(l_femur_gimbal_grp, ro=posOrientFemur, ws=True)
        l_knee_gimbal_grp = cmds.group(em=True, n="L_knee_gimbal_Grp")
        cmds.xform(l_knee_gimbal_grp, t=posTransKnee, ws=True)
        cmds.xform(l_knee_gimbal_grp, ro=posOrientKnee, ws=True)
        l_ankle_gimbal_grp = cmds.group(em=True, n="L_ankle_gimbal_Grp")
        cmds.xform(l_ankle_gimbal_grp, t=posTransAnkle, ws=True)
        cmds.xform(l_ankle_gimbal_grp, ro=posOrientAnkle, ws=True)
        l_ball_gimbal_grp = cmds.group(em=True, n="L_ball_gimbal_Grp")
        cmds.xform(l_ball_gimbal_grp, t=posTransBall, ws=True)
        cmds.xform(l_ball_gimbal_grp, ro=posOrientBall, ws=True)
        # freeze the orientation of the controllers
        cmds.makeIdentity(lFemurCtl, apply=True, r=True, t=True)
        cmds.makeIdentity(lKneeCtl, apply=True, r=True, t=True)
        cmds.makeIdentity(lAnkleCtl, apply=True, r=True, t=True)
        cmds.makeIdentity(lBallCtl, apply=True, r=True, t=True)
        # delete history of the controllers
        cmds.delete(lFemurCtl, channels=True)
        cmds.delete(lKneeCtl, channels=True)
        cmds.delete(lAnkleCtl, channels=True)
        cmds.delete(lBallCtl, channels=True)
        # move the group after the respected name
        cmds.xform(lFkFemurGrp, t=posTransFemur, worldSpace=True)
        cmds.xform(lFkKneeGrp, t=posTransKnee, worldSpace=True)
        cmds.xform(lFkAnkleGrp, t=posTransAnkle, worldSpace=True)
        cmds.xform(lFkBallGrp, t=posTransBall, worldSpace=True)
        # orient the group after the respected name
        cmds.xform(lFkFemurGrp, ro=posOrientFemur, worldSpace=True)
        cmds.xform(lFkKneeGrp, ro=posOrientKnee, worldSpace=True)
        cmds.xform(lFkAnkleGrp, ro=posOrientAnkle, worldSpace=True)
        cmds.xform(lFkBallGrp, ro=posOrientBall, worldSpace=True)
        # rotate the controls correctly
        cmds.rotate(0, 90, 0, lFemurCtl, relative=True)
        cmds.rotate(0, 90, 0, lKneeCtl, relative=True)
        cmds.rotate(0, 90, 0, lAnkleCtl, relative=True)
        cmds.rotate(0, 90, 0, lBallCtl, relative=True)
        # freeze the orientation of the controllers
        cmds.makeIdentity(lFemurCtl, apply=True, rotate=True, translate=True)
        cmds.makeIdentity(lKneeCtl, apply=True, rotate=True, translate=True)
        cmds.makeIdentity(lAnkleCtl, apply=True, rotate=True, translate=True)
        cmds.makeIdentity(lBallCtl, apply=True, rotate=True, translate=True)
        # delete history of the controllers
        cmds.delete(lOffsetFemurCtl, channels=True)
        cmds.delete(lOffsetKneeCtl, channels=True)
        cmds.delete(lOffsetAnkleCtl, channels=True)
        cmds.delete(lOffsetBallCtl, channels=True)
        # parent the xero out groups
        cmds.parent(l_femurZeroOut_grp, lOffsetFemurCtl)
        cmds.parent(l_kneeZeroOut_grp, lOffsetKneeCtl)
        cmds.parent(l_ankleZeroOut_grp, lOffsetAnkleCtl)
        cmds.parent(l_ballZeroOut_grp, lOffsetBallCtl)
        # parent the gimbals to the zeroOut groups
        cmds.parent(l_femur_gimbal_grp, l_femurZeroOut_grp)
        cmds.parent(l_knee_gimbal_grp, l_kneeZeroOut_grp)
        cmds.parent(l_ankle_gimbal_grp, l_ankleZeroOut_grp)
        cmds.parent(l_ball_gimbal_grp, l_ballZeroOut_grp)
        # parent the groups together
        cmds.parent(lFkBallGrp, l_ankle_gimbal_grp)
        cmds.parent(lFkAnkleGrp, l_knee_gimbal_grp)
        cmds.parent(lFkKneeGrp, l_femur_gimbal_grp)
        # set the controllers to control the joint limbs
        cmds.parentConstraint(lOffsetFemurCtl, fkFemur, maintainOffset=True)
        cmds.parentConstraint(lOffsetKneeCtl, fkKnee, maintainOffset=True)
        cmds.parentConstraint(lOffsetAnkleCtl, fkAnkle, maintainOffset=True)
        cmds.parentConstraint(lOffsetBallCtl, fkBall, maintainOffset=True)
        # break __ ___________
        cmds.addAttr(lFemurCtl, ln='seperator1', nn='__', at='enum', en='__________')
        cmds.setAttr(lFemurCtl[0]+'.seperator1', e=True, k=True, lock=True)
        cmds.addAttr(lKneeCtl, ln='seperator1', nn='__', at='enum', en='__________')
        cmds.setAttr(lKneeCtl[0]+'.seperator1', e=True, k=True, lock=True)
        cmds.addAttr(lAnkleCtl, ln='seperator1', nn='__', at='enum', en='__________')
        cmds.setAttr(lAnkleCtl[0]+'.seperator1', e=True, k=True, lock=True)
        cmds.addAttr(lBallCtl, ln='seperator1', nn='__', at='enum', en='__________')
        cmds.setAttr(lBallCtl[0]+'.seperator1', e=True, k=True, lock=True)
        # add hide on / off offset control and add them to the controls
        cmds.addAttr(lFemurCtl, ln='offsetVis', at='enum', en='off:on')
        cmds.setAttr(lFemurCtl[0]+'.offsetVis', e=True, k=True)
        cmds.addAttr(lKneeCtl, ln='offsetVis', at='enum', en='off:on')
        cmds.setAttr(lKneeCtl[0]+'.offsetVis', e=True, k=True)
        cmds.addAttr(lAnkleCtl, ln='offsetVis', at='enum', en='off:on')
        cmds.setAttr(lAnkleCtl[0]+'.offsetVis', e=True, k=True)
        cmds.addAttr(lBallCtl, ln='offsetVis', at='enum', en='off:on')
        cmds.setAttr(lBallCtl[0]+'.offsetVis', e=True, k=True)
        # Connect the attribute to the offset control
        cmds.connectAttr(lFemurCtl[0]+'.offsetVis', 'L_Fk_offsetFemur_CtlShape.lodVisibility')
        cmds.connectAttr(lKneeCtl[0]+'.offsetVis', 'L_Fk_offsetKnee_CtlShape.lodVisibility')
        cmds.connectAttr(lAnkleCtl[0]+'.offsetVis', 'L_Fk_offsetAnkle_CtlShape.lodVisibility')
        cmds.connectAttr(lBallCtl[0]+'.offsetVis', 'L_Fk_offsetBall_CtlShape.lodVisibility')
        # turn off visibility of the offset control
        cmds.setAttr(lFemurCtl[0]+'.offsetVis', 0)
        cmds.setAttr(lKneeCtl[0]+'.offsetVis', 0)
        cmds.setAttr(lAnkleCtl[0]+'.offsetVis', 0)
        cmds.setAttr(lBallCtl[0]+'.offsetVis', 0)
        #cmds.parent(l_femur_gimbal_grp, zeroOut_grp)
        # femur gimbal
        cmds.connectAttr(lFemurCtl[0]+'.gimbalX', l_femur_gimbal_grp+'.rotateX', force=True)
        cmds.connectAttr(lFemurCtl[0]+'.gimbalY', l_femur_gimbal_grp+'.rotateY', force=True)
        cmds.connectAttr(lFemurCtl[0]+'.gimbalZ', l_femur_gimbal_grp+'.rotateZ', force=True)
        # knee gimbal
        #cmds.connectAttr(lKneeCtl[0]+'.gimbalX', l_knee_gimbal_grp+'.rotateX', force=True)
        #cmds.connectAttr(lKneeCtl[0]+'.gimbalY', l_knee_gimbal_grp+'.rotateY', force=True)
        cmds.connectAttr(lKneeCtl[0]+'.gimbalZ', l_knee_gimbal_grp+'.rotateZ', force=True)
        # ankle gimbal
        cmds.connectAttr(lAnkleCtl[0]+'.gimbalX', l_ankle_gimbal_grp+'.rotateX', force=True)
        cmds.connectAttr(lAnkleCtl[0]+'.gimbalY', l_ankle_gimbal_grp+'.rotateY', force=True)
        cmds.connectAttr(lAnkleCtl[0]+'.gimbalZ', l_ankle_gimbal_grp+'.rotateZ', force=True)
        # ball gimbal
        #cmds.connectAttr(lBallCtl[0]+'.gimbalX', l_ball_gimbal_grp+'.rotateX', force=True)
        #cmds.connectAttr(lBallCtl[0]+'.gimbalY', l_ball_gimbal_grp+'.rotateY', force=True)
        cmds.connectAttr(lBallCtl[0]+'.gimbalZ', l_ball_gimbal_grp+'.rotateZ', force=True)
        # lock and hide translate, scale and visibility  
        # femur
        cmds.setAttr(lFemurCtl[0]+'.translateX', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lFemurCtl[0]+'.translateY', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lFemurCtl[0]+'.translateZ', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lFemurCtl[0]+'.scaleX', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lFemurCtl[0]+'.scaleY', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lFemurCtl[0]+'.scaleZ', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lFemurCtl[0]+'.visibility', lock=True, channelBox=False, keyable=False)    
        # knee
        cmds.setAttr(lKneeCtl[0]+'.translateX', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lKneeCtl[0]+'.translateY', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lKneeCtl[0]+'.translateZ', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lKneeCtl[0]+'.rotateX', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lKneeCtl[0]+'.rotateY', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lKneeCtl[0]+'.scaleX', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lKneeCtl[0]+'.scaleY', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lKneeCtl[0]+'.scaleZ', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lKneeCtl[0]+'.visibility', lock=True, channelBox=False, keyable=False)
        # ankle
        cmds.setAttr(lAnkleCtl[0]+'.translateX', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lAnkleCtl[0]+'.translateY', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lAnkleCtl[0]+'.translateZ', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lAnkleCtl[0]+'.scaleX', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lAnkleCtl[0]+'.scaleY', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lAnkleCtl[0]+'.scaleZ', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lAnkleCtl[0]+'.visibility', lock=True, channelBox=False, keyable=False)
        # ball
        cmds.setAttr(lBallCtl[0]+'.translateX', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lBallCtl[0]+'.translateY', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lBallCtl[0]+'.translateZ', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lBallCtl[0]+'.rotateX', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lBallCtl[0]+'.rotateY', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lBallCtl[0]+'.scaleX', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lBallCtl[0]+'.scaleY', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lBallCtl[0]+'.scaleZ', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lBallCtl[0]+'.visibility', lock=True, channelBox=False, keyable=False)
        # Offset lock and hide translate, scale and visibility  
        # offset femur
        cmds.setAttr(lOffsetFemurCtl[0]+'.translateX', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lOffsetFemurCtl[0]+'.translateY', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lOffsetFemurCtl[0]+'.translateZ', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lOffsetFemurCtl[0]+'.scaleX', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lOffsetFemurCtl[0]+'.scaleY', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lOffsetFemurCtl[0]+'.scaleZ', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lOffsetFemurCtl[0]+'.visibility', lock=True, channelBox=False, keyable=False)    
        # offset knee
        cmds.setAttr(lOffsetKneeCtl[0]+'.translateX', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lOffsetKneeCtl[0]+'.translateY', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lOffsetKneeCtl[0]+'.translateZ', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lOffsetKneeCtl[0]+'.rotateX', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lOffsetKneeCtl[0]+'.rotateY', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lOffsetKneeCtl[0]+'.scaleX', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lOffsetKneeCtl[0]+'.scaleY', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lOffsetKneeCtl[0]+'.scaleZ', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lOffsetKneeCtl[0]+'.visibility', lock=True, channelBox=False, keyable=False)
        # offset ankle
        cmds.setAttr(lOffsetAnkleCtl[0]+'.translateX', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lOffsetAnkleCtl[0]+'.translateY', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lOffsetAnkleCtl[0]+'.translateZ', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lOffsetAnkleCtl[0]+'.scaleX', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lOffsetAnkleCtl[0]+'.scaleY', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lOffsetAnkleCtl[0]+'.scaleZ', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lOffsetAnkleCtl[0]+'.visibility', lock=True, channelBox=False, keyable=False)
        # offset ball
        cmds.setAttr(lOffsetBallCtl[0]+'.translateX', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lOffsetBallCtl[0]+'.translateY', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lOffsetBallCtl[0]+'.translateZ', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lOffsetBallCtl[0]+'.rotateX', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lOffsetBallCtl[0]+'.rotateY', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lOffsetBallCtl[0]+'.scaleX', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lOffsetBallCtl[0]+'.scaleY', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lOffsetBallCtl[0]+'.scaleZ', lock=True, channelBox=False, keyable=False)
        cmds.setAttr(lOffsetBallCtl[0]+'.visibility', lock=True, channelBox=False, keyable=False)
        
        # place them in the group hierarchy if there is one
        placeInGroup = cmds.ls('main_Grp')
        # if it is there parent them respectly
        if placeInGroup:
            cmds.parent(lFkFemurGrp, 'L_Fk_Grp')    
        else:
            return
            
    # connect the Fk to the bind

            
        # connect the Fk to the bind

    
    def L_connectFk_leg(self):
    
        # this is done to many times, and should be boiled down when introducing class
        # find the worldposition ws translate position of femur, knee and ankle
        posTransFemur = cmds.xform('L_Fk_femur_jnt', q=True, t=True, ws=True)
        posTransKnee = cmds.xform('L_Fk_knee_jnt', q=True, t=True, ws=True)
        posTransAnkle = cmds.xform('L_Fk_ankle_jnt', q=True, t=True, ws=True)
    
        # find the worldposition ws orient position of femur, knee and ankle
        posOrientFemur = cmds.xform('L_Fk_femur_jnt', q=True, t=True, ws=True)
        posOrientKnee = cmds.xform('L_Fk_knee_jnt', q=True, t=True, ws=True)
        posOrientAnkle = cmds.xform('L_Fk_ankle_jnt', q=True, t=True, ws=True)
    
        # create or find 3 pairblend node to switch between ik and fk
        # femur connection
        femurPairNode = cmds.ls('L_femur_Pb')
    
        # if there already is a pairBlend node connect them together
        if femurPairNode:
            cmds.connectAttr('L_Fk_femur_jnt.rotate', 'L_femur_Pb.inRotate2', force=True)
    
        # if there are no pairBlend node then we create the node and connects them together
        else:
            cmds.shadingNode('pairBlend', asUtility=True, name='L_femur_Pb')
            cmds.connectAttr('L_Fk_femur_jnt.rotate', 'L_femur_Pb.inRotate2', force=True)       
    
        # knee connection   
        kneePairNode = cmds.ls('L_knee_Pb')
    
        # if there already is a pairBlend node connect them together
        if kneePairNode:
            cmds.connectAttr('L_Fk_knee_jnt.rotate', 'L_knee_Pb.inRotate2', force=True)
    
        # if there are no pairBlend node then we create the node and connects them together
        else:
            cmds.shadingNode('pairBlend', asUtility=True, name='L_knee_Pb')
            cmds.connectAttr('L_Fk_knee_jnt.rotate', 'L_knee_Pb.inRotate2', force=True)   
    
        # ankle connection   
        anklePairNode = cmds.ls('L_ankle_Pb')
        # if there already is a pairBlend node connect them together
        if anklePairNode:
            cmds.connectAttr('L_Fk_ankle_jnt.rotate', 'L_ankle_Pb.inRotate2', force=True)
        # if there are no pairBlend node then we create the node and connects them together
        else:
            cmds.shadingNode('pairBlend', asUtility=True, name='L_ankle_Pb')
            cmds.connectAttr('L_Fk_ankle_jnt.rotate', 'L_ankle_Pb.inRotate2', force=True)
    
        # ball connection
        ballPairNode = cmds.ls('L_ball_Pb')
        # if there already is a pairBlend node connect them together
        if ballPairNode:
            cmds.connectAttr('L_Fk_ball_jnt.rotate', 'L_ball_Pb.inRotate2', force=True)
        # if there are no pairBlend node then we create the node and connects them together
        else:
            cmds.shadingNode('pairBlend', asUtility=True, name='L_ball_Pb')
            cmds.connectAttr('L_Fk_ball_jnt.rotate', 'L_ball_Pb.inRotate2', force=True)       
    
        # connect the pairBlend node to the Rig joints
        # femur connection
        shldrConnect = cmds.listConnections('L_femur_jnt.rotate')
        if shldrConnect:
            print "this has a connection"
            return       
        else:
            cmds.connectAttr('L_femur_Pb.outRotate', 'L_femur_jnt.rotate', f=True)
           
        # knee connection      
            kneeConnect = cmds.listConnections('L_knee_jnt.rotate')
    
        if kneeConnect:
            print "this has a connection"
            return      
        else:
            cmds.connectAttr('L_knee_Pb.outRotate', 'L_knee_jnt.rotate', f=True)
    
        # ankle connection
        ankleConnect = cmds.listConnections('L_ankle_jnt.rotate')
        if ankleConnect:
            print "this has a connection"
            return       
        else:
            cmds.connectAttr('L_ankle_Pb.outRotate', 'L_ankle_jnt.rotate', f=True)
    
        # ball connection
        ballConnect = cmds.listConnections('L_ball_jnt.rotate')
        if ballConnect:
            print "this has a connection"
            return
        else:
            cmds.connectAttr('L_ball_Pb.outRotate', 'L_ball_jnt.rotate', f=True)
    
        # Find or create a control for switching between the Ik and Fk
        createCtl = cmds.ls('L_leg_IkFkSwitch_Ctl')
        if createCtl:
            print "control is there"
            return
        else:
            cmds.circle(n='L_leg_IkFkSwitch_Ctl', nr=(0, 0, 1), c=(0, 0, 0), r=0.75)
    
            # create a group for the switch control
            cmds.group(em=True, n='L_leg_IkFkSwitch_Grp')
    
            # parent the switch controller to the group
            cmds.parent('L_leg_IkFkSwitch_Ctl', 'L_leg_IkFkSwitch_Grp')
    
            # place the group above the hand
            cmds.xform('L_leg_IkFkSwitch_Grp', t=posTransAnkle, ws=True)
            cmds.xform('L_leg_IkFkSwitch_Grp', t=posOrientAnkle, ws=True)
    
            # turn the control to be horizontal and move it up
            cmds.xform('L_leg_IkFkSwitch_Ctl', r=True, ro=(-90, 0, 0))
            cmds.xform('L_leg_IkFkSwitch_Ctl', r=True, t=(0, 2, 0))
    
            # freeze the controlle
            cmds.makeIdentity('L_leg_IkFkSwitch_Ctl', a=True)
    
            # remove history
            cmds.delete('L_leg_IkFkSwitch_Ctl', ch=True)   
    
            # create attributes on the controller for ik fk switch, and the visibility
            cmds.addAttr('L_leg_IkFkSwitch_CtlShape', ln="ikFkSwitch", at='enum', en='Ik:Fk:', k=True)
            cmds.addAttr('L_leg_IkFkSwitch_CtlShape', ln="ikFkVisibility", at='enum', en='auto:both:', k=True)
    
            # connect the pairBlend to the ikFkSwitch
    
            cmds.connectAttr('L_leg_IkFkSwitch_CtlShape.ikFkSwitch', 'L_femur_Pb.weight')
            cmds.connectAttr('L_leg_IkFkSwitch_CtlShape.ikFkSwitch', 'L_knee_Pb.weight')
            cmds.connectAttr('L_leg_IkFkSwitch_CtlShape.ikFkSwitch', 'L_ankle_Pb.weight')
    
            # hide controls based on the selection ikFkVisibility attribute
            # create condition node and two reverse nodes for the setup
    
            cmds.shadingNode('reverse', n="L_ikFkVisibility01_Rev", au=True)
            cmds.shadingNode('reverse', n="L_ikFkVisibility02_Rev", au=True)
            cmds.shadingNode('condition', n="L_ikFkVisibility_Cnd", au=True)
    
            # set attributes on the condition node
    
            cmds.setAttr('L_ikFkVisibility_Cnd.operation', 0)
            cmds.setAttr('L_ikFkVisibility_Cnd.colorIfTrueR', 1)
            cmds.setAttr('L_ikFkVisibility_Cnd.colorIfTrueG', 1)
    
            # connect the ikFkSwitch to the nodes
            cmds.connectAttr('L_leg_IkFkSwitch_CtlShape.ikFkSwitch', "L_ikFkVisibility01_Rev.input.inputX")
            cmds.connectAttr('L_leg_IkFkSwitch_CtlShape.ikFkSwitch', "L_ikFkVisibility_Cnd.colorIfFalseR")
            cmds.connectAttr('L_leg_IkFkSwitch_CtlShape.ikFkVisibility', "L_ikFkVisibility02_Rev.input.inputX")
    
            # connect the reverse nodes to the condition
    
            cmds.connectAttr("L_ikFkVisibility01_Rev.output.outputX", "L_ikFkVisibility_Cnd.colorIfFalseG")
            cmds.connectAttr("L_ikFkVisibility02_Rev.output.outputX", "L_ikFkVisibility_Cnd.firstTerm")
    
            # connect the condition node to ik and fk control top groups, outColorG = Ik outColorR = Fk
    
            cmds.connectAttr('L_ikFkVisibility_Cnd.outColorG', 'L_Ik_foot_Grp.visibility')
            cmds.connectAttr('L_ikFkVisibility_Cnd.outColorG', 'L_leg_poleVec_Grp.visibility')
            cmds.connectAttr('L_ikFkVisibility_Cnd.outColorG', 'L_Ik_femur_jnt.visibility')
            cmds.connectAttr('L_ikFkVisibility_Cnd.outColorR', 'L_Fk_femur_Grp.visibility')
            cmds.connectAttr('L_ikFkVisibility_Cnd.outColorR', 'L_Fk_femur_jnt.visibility')
    
            # lock and hide the translate, rotate, scale and hide visibility
    
            #translate
            cmds.setAttr('L_leg_IkFkSwitch_Ctl.translateX', lock=True, channelBox=False, keyable=False)
            cmds.setAttr('L_leg_IkFkSwitch_Ctl.translateY', lock=True, channelBox=False, keyable=False)
            cmds.setAttr('L_leg_IkFkSwitch_Ctl.translateZ', lock=True, channelBox=False, keyable=False)
    
            #rotate
            cmds.setAttr('L_leg_IkFkSwitch_Ctl.rotateX', lock=True, channelBox=False, keyable=False)
            cmds.setAttr('L_leg_IkFkSwitch_Ctl.rotateY', lock=True, channelBox=False, keyable=False)
            cmds.setAttr('L_leg_IkFkSwitch_Ctl.rotateZ', lock=True, channelBox=False, keyable=False)
    
            #scale
            cmds.setAttr('L_leg_IkFkSwitch_Ctl.scaleX', lock=True, channelBox=False, keyable=False)
            cmds.setAttr('L_leg_IkFkSwitch_Ctl.scaleY', lock=True, channelBox=False, keyable=False)
            cmds.setAttr('L_leg_IkFkSwitch_Ctl.scaleZ', lock=True, channelBox=False, keyable=False)
    
            #visibility
            cmds.setAttr('L_leg_IkFkSwitch_Ctl.visibility', lock=False, channelBox=False, keyable=False)
    
            # parent the group respectively
            cmds.parent('L_leg_IkFkSwitch_Grp', 'L_Ik_Grp')
    
            # get the control to follow the hand by getting the top group parentConstrainted
            cmds.parentConstraint('L_ankle_jnt', 'L_leg_IkFkSwitch_Grp', maintainOffset=True)
            
            #parent the L_leg_IkFkSwitch_Ctl Shape node to the controls
            cmds.parent('L_leg_IkFkSwitch_CtlShape', 'L_Fk_femur_Ctl', add=True, shape=True)
            cmds.parent('L_leg_IkFkSwitch_CtlShape', 'L_Fk_knee_Ctl', add=True, shape=True)
            cmds.parent('L_leg_IkFkSwitch_CtlShape', 'L_Fk_ankle_Ctl', add=True, shape=True)
            cmds.parent('L_leg_IkFkSwitch_CtlShape', 'L_Fk_ball_Ctl', add=True, shape=True)
            
            #hide the shape node
            cmds.setAttr('L_leg_IkFkSwitch_CtlShape.lodVisibility', 0)
            
            #set the control to Fk
            cmds.setAttr("L_leg_IkFkSwitch_CtlShape.ikFkSwitch", 1)

        # connect the Ik to the bind    
    def L_connectIk_leg(self):
    
        # this is done to many times, and should be boiled down when introducing class
        # find the worldposition ws translate position of femur, knee and ankle
        posTransfemur = cmds.xform('L_Ik_femur_jnt', q=True, t=True, ws=True)
        posTransknee = cmds.xform('L_Ik_knee_jnt', q=True, t=True, ws=True)
        posTransankle = cmds.xform('L_Ik_ankle_jnt', q=True, t=True, ws=True)
    
        # find the worldposition ws orient position of femur, knee and ankle
        posOrientfemur = cmds.xform('L_Ik_femur_jnt', q=True, t=True, ws=True)
        posOrientknee = cmds.xform('L_Ik_knee_jnt', q=True, t=True, ws=True)
        posOrientankle = cmds.xform('L_Ik_ankle_jnt', q=True, t=True, ws=True)
    
        # create or find 3 pairblend node to connect the fk joints to 
        # femur connection
        femurPairNode = cmds.ls('L_femur_Pb')
    
        # if there already is a pairBlend node connect them together
        if femurPairNode:
            cmds.connectAttr('L_Ik_femur_jnt.rotate', 'L_femur_Pb.inRotate1', force=True)
    
        # if there are no pairBlend node then we create the node and connects them together
        else:
            cmds.shadingNode('pairBlend', asUtility=True, name='L_femur_Pb')
            cmds.connectAttr('L_Ik_femur_jnt.rotate', 'L_femur_Pb.inRotate1', force=True)
           
        # knee connection  
        kneePairNode = cmds.ls('L_knee_Pb')
    
        # if there already is a pairBlend node connect them together
        if kneePairNode:
            cmds.connectAttr('L_Ik_knee_jnt.rotate', 'L_knee_Pb.inRotate1', force=True)
    
        # if there are no pairBlend node then we create the node and connects them together
    
        else:
            cmds.shadingNode('pairBlend', asUtility=True, name='L_knee_Pb')
            cmds.connectAttr('L_Ik_knee_jnt.rotate', 'L_knee_Pb.inRotate1', force=True)   
    
        # ankle connection   
        anklePairNode = cmds.ls('L_ankle_Pb')
    
        # if there already is a pairBlend node connect them together
        if anklePairNode:
            cmds.connectAttr('L_Ik_ankle_jnt.rotate', 'L_ankle_Pb.inRotate1', force=True)
    
        # if there are no pairBlend node then we create the node and connects them together
        else:
            cmds.shadingNode('pairBlend', asUtility=True, name='L_ankle_Pb')
            cmds.connectAttr('L_Ik_ankle_jnt.rotate', 'L_ankle_Pb.inRotate1', force=True)
            
            
        # ball connection   
        ballPairNode = cmds.ls('L_ball_Pb')
    
        # if there already is a pairBlend node connect them together
        if ballPairNode:
            cmds.connectAttr('L_Ik_ball_jnt.rotate', 'L_ball_Pb.inRotate1', force=True)
    
        # if there are no pairBlend node then we create the node and connects them together
        else:
            cmds.shadingNode('pairBlend', asUtility=True, name='L_ball_Pb')
            cmds.connectAttr('L_Ik_ball_jnt.rotate', 'L_ball_Pb.inRotate1', force=True)
   
        # connect the pairBlend node to the Rig joints    
        # femur connection    
        shldrConnect = cmds.listConnections('L_femur_jnt.rotate')
        if shldrConnect:
            print "this has a connection"    
            return     
        else:
            cmds.connectAttr('L_femur_Pb.outRotate', 'L_femur_jnt.rotate', f=True)
           
        # knee connection      
            kneeConnect = cmds.listConnections('L_knee_jnt.rotate')
        if kneeConnect:    
            print "this has a connection"
            return       
        else:
            cmds.connectAttr('L_knee_Pb.outRotate', 'L_knee_jnt.rotate', f=True)
    
        # ankle connection
        ankleConnect = cmds.listConnections('L_ankle_jnt.rotate')
        if ankleConnect:
            print "this has a connection"
            return      
        else:
            cmds.connectAttr('L_ankle_Pb.outRotate', 'L_ankle_jnt.rotate', f=True)
    
        # ball connection
        ballConnect = cmds.listConnections('L_ball_jnt.rotate')
        if ballConnect:
            print "this has a connection"
    
            return       
        else:
            cmds.connectAttr('L_ball_Pb.outRotate', 'L_ball_jnt.rotate', f=True)       
    
        # Find or create a control for switching between the Ik and Fk
        createCtl = cmds.ls('L_leg_IkFkSwitch_Ctl')
        if createCtl:
            print "control is there"
            return       
        else:
            cmds.circle(n='L_leg_IkFkSwitch_Ctl', nr=(0, 0, 1), c=(0, 0, 0), r=0.75)
    
            # create a group for the switch control
            cmds.group(em=True, n='L_leg_IkFkSwitch_Grp')
    
            # parent the switch controller to the group
            cmds.parent('L_leg_IkFkSwitch_Ctl', 'L_leg_IkFkSwitch_Grp')
    
            # place the group above the hand
            cmds.xform('L_leg_IkFkSwitch_Grp', t=posTransankle, ws=True)
            cmds.xform('L_leg_IkFkSwitch_Grp', t=posOrientankle, ws=True)
    
            # turn the control to be horizontal and move it up
            cmds.xform('L_leg_IkFkSwitch_Ctl', r=True, ro=(-90, 0, 0))
            cmds.xform('L_leg_IkFkSwitch_Ctl', r=True, t=(0, 2, 0))
    
            # freeze the controlle
            cmds.makeIdentity('L_leg_IkFkSwitch_Ctl', a=True)
    
            # remove history
            cmds.delete('L_leg_IkFkSwitch_Ctl', ch=True)   
    
            # create attributes on the controller for ik fk switch, and the visibility
            cmds.addAttr('L_leg_IkFkSwitch_CtlShape', ln="ikFkSwitch", at='enum', en='Ik:Fk:', k=True)
            cmds.addAttr('L_leg_IkFkSwitch_CtlShape', ln="ikFkVisibility", at='enum', en='auto:both:', k=True)
    
            # connect the pairBlend to the ikFkSwitch
            cmds.connectAttr('L_leg_IkFkSwitch_CtlShape.ikFkSwitch', 'L_femur_Pb.weight')
            cmds.connectAttr('L_leg_IkFkSwitch_CtlShape.ikFkSwitch', 'L_knee_Pb.weight')
            cmds.connectAttr('L_leg_IkFkSwitch_CtlShape.ikFkSwitch', 'L_ankle_Pb.weight')
    
            # hide controls based on the selection ikFkVisibility attribute
            # create condition node and two reverse nodes for the setup
            cmds.shadingNode('reverse', n="L_ikFkVisibility01_Rev", au=True)
            cmds.shadingNode('reverse', n="L_ikFkVisibility02_Rev", au=True)
            cmds.shadingNode('condition', n="L_ikFkVisibility_Cnd", au=True)
    
            # set attributes on the condition node
            cmds.setAttr('L_ikFkVisibility_Cnd.operation', 0)
            cmds.setAttr('L_ikFkVisibility_Cnd.colorIfTrueR', 1)
            cmds.setAttr('L_ikFkVisibility_Cnd.colorIfTrueG', 1)
    
            # connect the ikFkSwitch to the nodes
            cmds.connectAttr('L_leg_IkFkSwitch_CtlShape.ikFkSwitch', "L_ikFkVisibility01_Rev.input.inputX")
            cmds.connectAttr('L_leg_IkFkSwitch_CtlShape.ikFkSwitch', "L_ikFkVisibility_Cnd.colorIfFalseR")
            cmds.connectAttr('L_leg_IkFkSwitch_CtlShape.ikFkVisibility', "L_ikFkVisibility02_Rev.input.inputX")
    
            # connect the reverse nodes to the condition
            cmds.connectAttr("L_ikFkVisibility01_Rev.output.outputX", "L_ikFkVisibility_Cnd.colorIfFalseG")
            cmds.connectAttr("L_ikFkVisibility02_Rev.output.outputX", "L_ikFkVisibility_Cnd.firstTerm")
    
            # connect the condition node to ik and fk control top groups, outColorG = Ik outColorR = Fk
            cmds.connectAttr('L_ikFkVisibility_Cnd.outColorG', 'L_Ik_foot_Grp.visibility')
            cmds.connectAttr('L_ikFkVisibility_Cnd.outColorG', 'L_leg_poleVec_Grp.visibility')
            cmds.connectAttr('L_ikFkVisibility_Cnd.outColorG', 'L_Ik_femur_jnt.visibility')
            cmds.connectAttr('L_ikFkVisibility_Cnd.outColorR', 'L_Fk_femur_Grp.visibility')
            cmds.connectAttr('L_ikFkVisibility_Cnd.outColorR', 'L_Fk_femur_jnt.visibility')
    
            # lock and hide the translate, rotate, scale and hide visibility
            #translate
            cmds.setAttr('L_leg_IkFkSwitch_Ctl.translateX', lock=True, channelBox=False, keyable=False)
            cmds.setAttr('L_leg_IkFkSwitch_Ctl.translateY', lock=True, channelBox=False, keyable=False)
            cmds.setAttr('L_leg_IkFkSwitch_Ctl.translateZ', lock=True, channelBox=False, keyable=False)
    
            #rotate
            cmds.setAttr('L_leg_IkFkSwitch_Ctl.rotateX', lock=True, channelBox=False, keyable=False)
            cmds.setAttr('L_leg_IkFkSwitch_Ctl.rotateY', lock=True, channelBox=False, keyable=False)
            cmds.setAttr('L_leg_IkFkSwitch_Ctl.rotateZ', lock=True, channelBox=False, keyable=False)
    
            #scale
            cmds.setAttr('L_leg_IkFkSwitch_Ctl.scaleX', lock=True, channelBox=False, keyable=False)
            cmds.setAttr('L_leg_IkFkSwitch_Ctl.scaleY', lock=True, channelBox=False, keyable=False)
            cmds.setAttr('L_leg_IkFkSwitch_Ctl.scaleZ', lock=True, channelBox=False, keyable=False)
    
            #visibility
            cmds.setAttr('L_leg_IkFkSwitch_Ctl.visibility', lock=False, channelBox=False, keyable=False)
    
            # parent the group respectively
            cmds.parent('L_leg_IkFkSwitch_Grp', 'L_Ik_Grp')
    
            # get the control to follow the hand by getting the top group parentConstrainted
            cmds.parentConstraint('L_ankle_jnt', 'L_leg_IkFkSwitch_Grp', maintainOffset=True)
            
            #parent the L_leg_IkFkSwitch_Ctl Shape node to the controls
            cmds.parent('L_leg_IkFkSwitch_CtlShape', 'L_Ik_knee_Ctl', add=True, shape=True)
            cmds.parent('L_leg_IkFkSwitch_CtlShape', 'L_Ik_foot_Ctl', add=True, shape=True)
            
            #hide the shape node
            cmds.setAttr('L_leg_IkFkSwitch_CtlShape.lodVisibility', 0)
